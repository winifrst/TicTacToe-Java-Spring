<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <style>
        .cell { width: 50px; height: 50px; border: 1px solid black; text-align: center; font-size: 24px; }
        .board { display: grid; grid-template-columns: repeat(3, 50px); gap: 2px; margin: 20px; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
<h1>–ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏</h1>

<button onclick="createGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
<div id="gameId"></div>

<div class="board" id="board">
    <div class="cell" onclick="makeMove(0,0)"></div>
    <div class="cell" onclick="makeMove(0,1)"></div>
    <div class="cell" onclick="makeMove(0,2)"></div>
    <div class="cell" onclick="makeMove(1,0)"></div>
    <div class="cell" onclick="makeMove(1,1)"></div>
    <div class="cell" onclick="makeMove(1,2)"></div>
    <div class="cell" onclick="makeMove(2,0)"></div>
    <div class="cell" onclick="makeMove(2,1)"></div>
    <div class="cell" onclick="makeMove(2,2)"></div>
</div>

<div id="status">–°–æ–∑–¥–∞–π—Ç–µ –∏–≥—Ä—É</div>

<script>
    let gameId = null;
    let board = [[0,0,0],[0,0,0],[0,0,0]];

    // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
    async function createGame() {
        const response = await fetch('/game/new', { method: 'POST' });
        const game = await response.json();
        gameId = game.gameId;
        board = game.board;
        document.getElementById('gameId').textContent = 'ID –∏–≥—Ä—ã: ' + gameId;
        document.getElementById('status').textContent = '–í–∞—à —Ö–æ–¥';
        updateBoard();
    }

    // –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥
    async function makeMove(row, col) {
        if (!gameId || board[row][col] !== 0) return;

        // –•–æ–¥ –∏–≥—Ä–æ–∫–∞
        board[row][col] = 1;
        updateBoard();

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        const response = await fetch(`/game/${gameId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ board: board })
        });

        const result = await response.json();
        board = result.board;

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç–∞—Ç—É—Å –≤ —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
        const statusText = getStatusText(result.status);
        document.getElementById('status').textContent = statusText;
        updateBoard();
    }

    // –û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å–∫—É
    function updateBoard() {
        const cells = document.querySelectorAll('.cell');
        let index = 0;
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                cells[index].textContent =
                    board[i][j] === 1 ? 'X' :
                    board[i][j] === 2 ? 'O' : '';
                index++;
            }
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
    function getStatusText(status) {
        const statusMap = {
            'IN_PROGRESS': '–ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è',
            'PLAYER_WON': '–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏! üéâ',
            'COMPUTER_WON': '–ö–æ–º–ø—å—é—Ç–µ—Ä –≤—ã–∏–≥—Ä–∞–ª ü§ñ',
            'DRAW': '–ù–∏—á—å—è!',
            'NEW_GAME': '–ù–æ–≤–∞—è –∏–≥—Ä–∞',
            'INVALID_MOVE': '–ù–µ–≤–µ—Ä–Ω—ã–π —Ö–æ–¥'
        };

        return statusMap[status] || status; // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
    }
</script>
</body>
</html>