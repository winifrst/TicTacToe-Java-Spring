# Привет

Сегодняшняя цель - научиться добавлять и работать с авторизацией и базой данных в веб-приложение на языке **Java** с использованием Spring.

# Информация

### Авторизация

Средства авторизации контролируют доступ легальных пользователей к ресурсам системы, предоставляя каждому из них именно те права, которые ему были определены администратором.

### Идентификация, аутентификация, авторизация

**Идентификация** - процедура, в результате выполнения которой для субъекта выявляется его уникальный признак, однозначно определяющий его в информационной системе.

**Аутентификация** - процедура проверки подлинности, например проверка подлинности пользователя путем сравнения введенного им пароля с паролем, сохраненным в системе.

**Авторизация** - предоставление определенному лицу или группе лиц прав на выполнение определенного набора действий.

### Авторизация с помощью логина и пароля

Метод основывается на том, что пользователь должен предоставить логин и пароль для успешной идентификации и аутентификации в системе. Пара логина и пароля задается пользователем при его регистрации в системе.
В случае успешной авторизации на сервере пользователю выдаются права на выполнение доступных ему запросов.

Клиент отправляет запрос на сервер и получает в виде ответа сообщение "Unauthorized" вместе с информацией о порядке авторизации.
После успешного прохождения авторизации в каждый последующий запрос клиента автоматически добавляется заголовок "Authorization" ([формирование заголовка авторизации](https://datatracker.ietf.org/doc/html/rfc7617)), в котором передаются данные клиента для аутентификации сервером.

<div align="center">
  <img src="misc/images/Auth.png"/>
</div>

Существуют и [другие способы авторизации](https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication#authentication_schemes).


# Проект: Крестики-Нолики
## Темы

- веб-приложение;
- авторизация по паре логина и пароля (basic auth);
- PostgreSQL;
- Spring.

# Задачи

Используйте проект для серверной части с предыдущей недели T03.

### Задание 1. Добавление базы данных
- Опишите подключение к базе данных PostgreSQL в application.properties
- Избавьтесь от класса-хранилища
- Добавьте специальные аннотации для классов, которые необходимо сохранять в базу данных
- Используйте у репозиториев в качестве родителя CrudRepository

### Задание 2. Добавление авторизации
- Добавьте пользователей, у которых будет UUID, логин, пароль
- Реализуйте поддержку пользователей на всех слоях
- Создайте модель SignUpRequest, у которой будет логин и пароль
- Создайте сервис авторизации, который использует UserService:
    - Метод регистрации, который принимает SignUpRequest и возвращает факт успешной регистрации
    - Метод авторизации, который принимает в заголовке логин и пароль в виде base64(login:password) и возвращает UUID пользователя
- Создайте контроллер авторизации, у которого будут следующие endpoint'ы:
    - Для регистрации пользователя
    - Для авторизации пользователя
- Создайте класс AuthFilter, сделайте наследование от GenericFilterBean и реализуйте метод doFilter
    - Провалидируйте логин и пароль
    - Если валидация прошла успешно, то выполните запрос
    - Если валидация прошла с ошибкой, то добавьте в ответ 401 код и не выполняйте запрос
- Создайте Spring Configuration, где:
    - Опишите Bean для получения SecurityFilterChain
    - Разрешите доступ без авторизации к endpoint'ам регистрации и авторизации
    - Для всех остальных endpoint'ов должна требоваться авторизация
    - Воспользуйтесь AuthFilter в качестве фильтра

### Задание 3. Добавление логики игры между двумя игроками
- Добавьте состояния для текущей игры:
    - Ожидание игроков
    - Ход игрока с UUID
    - Ничья
    - Победа игрока с UUID
- Добавьте информацию о значках, которыми будут ходить пользователи, в текущую игру
- Улучшить алгоритм определения окончания игры с использованием состояний
- Добавить endpoint для создания новой игры с пользователем или компьютером
- Добавить endpoint для получения доступных текущих игр
- Добавить endpoint для присоединения пользователя к игре
- Улучшить endpoint обновления текущей игры с учетом игры с пользователем или компьютером
- Добавить endpoint для получения текущей игры
- Добавить endpoint для получения информации о пользователе по UUID

